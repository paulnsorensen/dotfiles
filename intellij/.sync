#!/bin/bash

set -e

script_dir=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )


platform=$(uname)

# TODO: figure out how to use this
# if [[ ! -a ~/.ideavimrc ]]
# then
#   ln -s $script_dir/ideavimrc ~/.ideavimrc
# fi

# TODO: add community version here
intellij_versions=("IntelliJIdea2017.1")

for version in "${intellij_versions[@]}"
do
  for config in $(find ${script_dir}/config -depth 1 -name "[!.]*" | xargs -n 1 basename)
  do
    if [[ $platform == *Darwin* ]]
    then
      if [[ ! -a ~/Library/Preferences/$version/$config ]]
      then
        ln -s $script_dir/config/$config ~/Library/Preferences/$version/$config
      else
        echo "~/Library/Preferences/$version/$config already exists! Diff:"
        echo $(diff -rq $script_dir/config/$config ~/Library/Preferences/$version/$config)
      fi
      # TODO: Decide if you need this
      # else
      # mkdir -p ~/.$name
      #
      # if [[ ! -a ~/.$name/config ]]
      # then
      #   ln -s $script_dir/config ~/.$name/config
      # fi
    fi
  done
done
